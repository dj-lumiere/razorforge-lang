# Suflae Arbitrary Precision Test
# Tests Integer (bigint) and Decimal (bigdecimal) as default types

routine factorial(n: Integer) -> Integer:
    if n <= 1:
        return 1
    return n * factorial(n - 1)

routine fibonacci(n: Integer) -> Integer:
    if n <= 1:
        return n

    var a = 0
    var b = 1
    var i = 2

    while i <= n:
        let temp = a + b
        a = b
        b = temp
        i += 1

    return b

routine test_integer():
    Console.show_line("=== Integer (Arbitrary Precision) ===")

    # Large factorial - would overflow s64
    let fact_50 = factorial(50)
    Console.show_line(f"50! = {fact_50}")

    # Large fibonacci - would overflow s64
    let fib_100 = fibonacci(100)
    Console.show_line(f"fib(100) = {fib_100}")

    # Very large numbers
    let big = 999999999999999999999999999999
    let bigger = big * big
    Console.show_line(f"big^2 = {bigger}")

    # GCD and LCM
    let a = 123456789012345678901234567890
    let b = 987654321098765432109876543210
    Console.show_line(f"gcd = {a.gcd(b)}")
    Console.show_line(f"lcm = {a.lcm(b)}")

    Console.show_line()

routine test_decimal():
    Console.show_line("=== Decimal (Arbitrary Precision) ===")

    # Exact decimal arithmetic - no floating point errors
    let a = 0.1
    let b = 0.2
    let c = a + b
    Console.show_line(f"0.1 + 0.2 = {c}")  # Exact 0.3, not 0.30000000000000004

    # High precision pi calculation
    let pi = Decimal.pi(100)
    Console.show_line(f"pi (100 digits) = {pi}")

    # High precision e calculation
    let e = Decimal.e(100)
    Console.show_line(f"e (100 digits) = {e}")

    # Trigonometric functions with precision
    let angle = pi / 4
    Console.show_line(f"sin(pi/4) = {angle.sin(50)}")
    Console.show_line(f"cos(pi/4) = {angle.cos(50)}")

    # Square root with high precision
    let sqrt2 = Decimal(2).sqrt(100)
    Console.show_line(f"sqrt(2) (100 digits) = {sqrt2}")

    Console.show_line()

routine test_mixed():
    Console.show_line("=== Mixed Integer/Decimal ===")

    # Integer to Decimal promotion
    let int_val: Integer = 42
    let dec_val: Decimal = 3.14
    let result = int_val + dec_val  # Auto-promotes to Decimal
    Console.show_line(f"42 + 3.14 = {result}")

    # Fraction support
    let half = 1 / 2  # Fraction by default
    let third = 1 / 3
    let sum = half + third  # 5/6
    Console.show_line(f"1/2 + 1/3 = {sum}")

    Console.show_line()

routine start():
    Console.show_line("Suflae Arbitrary Precision Test")
    Console.show_line("================================")
    Console.show_line()

    test_integer()
    test_decimal()
    test_mixed()

    Console.show_line("All tests completed!")
